<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Generador de etiquetas EBUM</title>
    <link rel="stylesheet" href="index.css">
</head>
<body>
    <div class="upload-container">
        <h2>Carga la base de datos de etiquetas</h2>
        <form id="upload-form">
            <p>Sube un archivo CSV, XLS o XLSX con las informacion para las etiquetas.</p>
            <input type="file" id="file-input" accept=".csv,.xls,.xlsx" required>
            <br>
            <p>Sube un archivo de configuración JSON que contenga los parámetros necesarios para la generación de etiquetas.</p>
            <input type="file" id="file-config" accept=".json" required>
            <br>
            <button type="submit" class="upload-btn">Ejecutar</button>
        </form>
    </div>
    <script>
        const form = document.getElementById('upload-form');
        const fileInput = document.getElementById('file-input');
        const fileConfig = document.getElementById('file-config');

        form.addEventListener('submit', async (e) => {
            e.preventDefault();
            const file = fileInput.files[0];
            const config = fileConfig.files[0];
            if (!file) return;
            if (!config) return;

            const formData = new FormData();
            formData.append('file', file);
            formData.append('config', config);

            const response = await fetch('/api/build_labels/', {
                method: 'POST',
                body: formData
            });
            const responseBody = await response.json();
            const errors = responseBody.errors;
            const labels = responseBody.labels;
            if (errors && errors.length > 0) {
                alert("Errores:\n" + errors.join("\n"));
            }
            if (labels) {
                const blob = new Blob([labels], { type: "text/html" });
                const url = URL.createObjectURL(blob);
                window.open(url, "_blank");
            }
        });
    </script>
</body>
</html>